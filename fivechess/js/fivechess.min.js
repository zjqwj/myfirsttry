var game={BW:1,WIDTH:15,chess:[],wins:null,count:0,playerWin:[],computerWin:[],playerWeight:[],computerWeight:[],chessClone:[],pwinClone:[],cwinClone:[],step:0,isPlayer1:true,GAMEOVER:false,init:function(){this.GAMEOVER=false;var a=this.WIDTH;for(var c=0;c<a;c++){this.chess[c]=[];for(var b=0;b<a;b++){this.chess[c][b]=0}}this.renewWeight();this.paintBoard();if(this.wins==null){this.calcWins()}for(var c=0;c<this.count;c++){this.playerWin[c]=0;this.computerWin[c]=0}this.bind()},renewWeight:function(){var a=this.WIDTH;for(var c=0;c<a;c++){this.playerWeight[c]=[];this.computerWeight[c]=[];for(var b=0;b<a;b++){this.playerWeight[c][b]=0;this.computerWeight[c][b]=0}}},paintBoard:function(){var a=c1.getContext("2d");a.clearRect(0,0,600,600);a.beginPath();for(var b=0;b<15;b++){a.moveTo(20,20+b*40);a.lineTo(580,20+b*40);a.moveTo(20+b*40,20);a.lineTo(20+b*40,580)}a.stroke();a.beginPath();a.fillStyle="#000";a.arc(300,300,5,0,Math.PI*2);a.closePath();a.arc(140,140,5,0,Math.PI*2);a.closePath();a.arc(140,460,5,0,Math.PI*2);a.closePath();a.arc(460,460,5,0,Math.PI*2);a.closePath();a.arc(460,140,5,0,Math.PI*2);a.closePath();a.fill()},calcWins:function(){var a=this.WIDTH;this.wins=[];for(var d=0;d<a;d++){this.wins[d]=[];for(var c=0;c<a;c++){this.wins[d][c]=[]}}for(var d=0;d<a;d++){for(var c=0;c<a-4;c++){for(var b=0;b<5;b++){this.wins[d][c+b][this.count]=true}this.count++}}for(var d=0;d<a-4;d++){for(var c=0;c<a;c++){for(var b=0;b<5;b++){this.wins[d+b][c][this.count]=true}this.count++}}for(var d=0;d<a-4;d++){for(var c=0;c<a-4;c++){for(var b=0;b<5;b++){this.wins[d+b][c+b][this.count]=true}this.count++}}for(var d=0;d<a-4;d++){for(var c=4;c<a;c++){for(var b=0;b<5;b++){this.wins[d+b][c-b][this.count]=true}this.count++}}},updateView:function(){var a=c1.getContext("2d");this.renewWeight();this.paintBoard();for(var c=0;c<this.chess.length;c++){for(var b=0;b<this.chess[c].length;b++){if(this.chess[c][b]==1){a.beginPath();a.arc(20+40*b,20+40*c,15,0,Math.PI*2);a.closePath();a.fillStyle="#000";a.fill()}else{if(this.chess[c][b]===2){a.beginPath();a.arc(20+40*b,20+40*c,15,0,Math.PI*2);a.closePath();a.fillStyle="#fff";a.fill()}}}}},bind:function(){var a=this;pvp.onclick=function(){a.pvp(a);choosePattern.style.display="none"};pve.onclick=function(){choosePattern.style.display="none";a.pve(a)};gameBegin.onclick=function(){pWin.style.display="none";a.init()};btnWhite.onclick=function(){white.style.display="none";a.init()};btnBlack.onclick=function(){black.style.display="none";a.init()};gameBeg.onclick=function(){cWin.style.display="none";a.init()};restart.onclick=function(){a.init()};regret.onclick=function(){if(a.isPlayer1){a.BW=2;a.isPlayer1=false}else{a.BW=1;a.isPlayer1=true}if(a.step<2){return}a.step--;console.log(a.step);for(var c=0;c<15;c++){for(var b=0;b<15;b++){a.chess[c][b]=a.chessClone[a.step][c][b]}}for(var c=0;c<a.count;c++){a.playerWin[c]=a.cwinClone[a.step][c];a.computerWin[c]=a.pwinClone[a.step][c]}a.paintBoard();a.updateView()}},pvp:function(a){c1.onclick=function(l){var d=l.offsetX;var n=l.offsetY;for(var h=0;h<15;h++){for(var g=0;g<15;g++){var c=20+40*g;var m=20+40*h;var b=Math.sqrt((d-c)*(d-c)+(n-m)*(n-m));if((b<15)&&(a.chess[h][g]==0)){a.chess[h][g]=a.BW;for(var f=0;f<a.count;f++){if(a.wins[h][g][f]){if(a.BW==1){a.playerWin[f]++;a.computerWin[f]=6;if(a.playerWin[f]==5){black.style.display="block";a.GAMEOVER=true}}else{if(a.BW==2){a.computerWin[f]++;a.playerWin[f]=6;if(a.computerWin[f]==5){white.style.display="block";a.GAMEOVER=true}}}}}if(a.isPlayer1==true){a.BW=2;a.isPlayer1=false}else{a.BW=1;a.isPlayer1=true}a.updateView();a.clone(a)}}}}},rn:function(b,a){return Math.floor(Math.random()*(a-b+1)+b)},pve:function(a){var c=a.rn(6,8);var b=a.rn(6,8);a.chess[c][b]=2;a.updateView(a);c1.onclick=function(n){var g=n.offsetX;var p=n.offsetY;console.log(g);;a.BW=1;for(var m=0;m<15;m++){for(var l=0;l<15;l++){var f=20+40*l;var o=20+40*m;var d=Math.sqrt((g-f)*(g-f)+(p-o)*(p-o));if((d<15&&a.BW==1)&&(a.chess[m][l]!=1&&a.chess[m][l]!=2)){a.chess[m][l]=a.BW;for(var h=0;h<a.count;h++){if(a.wins[m][l][h]){a.playerWin[h]++;a.computerWin[h]=6;if(a.playerWin[h]==5){pWin.style.display="block";a.GAMEOVER=true}}}a.computerAI(a);a.updateView();a.clone(a)}}}}},clone:function(c){c.step++;c.chessClone[c.step]=[];for(var b=0;b<15;b++){c.chessClone[c.step][b]=[];for(var a=0;a<15;a++){c.chessClone[c.step][b][a]=c.chess[b][a]}}c.cwinClone[c.step]=[];c.pwinClone[c.step]=[];for(var b=0;b<c.count;b++){c.cwinClone[c.step][b]=c.playerWin[b];c.pwinClone[c.step][b]=c.computerWin[b]}},computerAI:function(d){d.BW=2;d.calc(d);var f=0;var g=0;var e=0;var l=0;var h=0;for(var c=0;c<15;c++){for(var b=0;b<15;b++){if(this.chess[c][b]==2||this.chess[c][b]==1){this.playerWeight[c][b]=0;this.computerWeight[c][b]=0}if(this.chess[c][b]==0){if(f<this.playerWeight[c][b]){g=c;e=b;l=c;h=b;f=this.playerWeight[c][b]}else{if(f==this.playerWeight[c][b]){if(this.computerWeight[c][b]>this.computerWeight[l][h]){g=c;e=b;l=c;h=b;f=this.playerWeight[c][b]}}}if(f<this.computerWeight[c][b]){g=c;e=b;l=c;h=b;f=this.computerWeight[c][b]}else{if(f==this.computerWeight[c][b]){if(this.playerWeight[c][b]>this.playerWeight[l][h]){g=c;e=b;l=c;h=b;f=this.computerWeight[c][b]}}}}}}d.chess[g][e]=d.BW;if(d.GAMEOVER==false){for(var a=0;a<d.count;a++){if(d.wins[g][e][a]){d.computerWin[a]++;d.playerWin[a]=6;if(d.computerWin[a]==5){cWin.style.display="block";d.GAMEOVER=true}}}}},calc:function(d){for(var c=0;c<15;c++){d.computerWeight[c]=[];for(var b=0;b<15;b++){d.computerWeight[c][b]=0}}for(var c=0;c<15;c++){for(var b=0;b<15;b++){if(d.chess[c][b]==0){for(var a=0;a<d.count;a++){if(d.wins[c][b][a]){if(d.playerWin[a]==1){d.playerWeight[c][b]+=20}else{if(d.playerWin[a]==2){d.playerWeight[c][b]+=40}else{if(d.playerWin[a]==3){d.playerWeight[c][b]+=200}else{if(d.playerWin[a]==4){d.playerWeight[c][b]+=1000}}}}if(d.computerWin[a]==1){d.computerWeight[c][b]+=22}else{if(d.computerWin[a]==2){d.computerWeight[c][b]+=42}else{if(d.computerWin[a]==3){d.computerWeight[c][b]+=220}else{if(d.computerWin[a]==4){d.computerWeight[c][b]+=2000}}}}}}}}}}};game.init();